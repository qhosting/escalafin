
{
  "name": "EscalaFin Multi-Instance Template",
  "description": "Sistema de Gestión de Créditos - Plantilla para múltiples instancias",
  "version": "1.0.0",
  "type": "docker-compose",
  "logo": "https://placehold.co/1200x600/e2e8f0/1e293b?text=Logo_of_EscalaFin__a_financial_credit_management_s",
  "variables": [
    {
      "name": "INSTANCE_NAME",
      "description": "Nombre único de la instancia",
      "required": true,
      "default": "cliente1"
    },
    {
      "name": "DOMAIN",
      "description": "Dominio para esta instancia",
      "required": true,
      "default": "cliente1.escalafin.com"
    },
    {
      "name": "DATABASE_NAME",
      "description": "Nombre de la base de datos",
      "required": true,
      "default": "escalafin_${INSTANCE_NAME}"
    },
    {
      "name": "POSTGRES_PASSWORD",
      "description": "Password de PostgreSQL",
      "required": true,
      "generate": "password"
    },
    {
      "name": "NEXTAUTH_SECRET",
      "description": "Secret para NextAuth",
      "required": true,
      "generate": "base64:32"
    },
    {
      "name": "REDIS_PASSWORD",
      "description": "Password de Redis",
      "required": true,
      "generate": "password"
    },
    {
      "name": "OPENPAY_MERCHANT_ID",
      "description": "ID del comercio en Openpay",
      "required": false
    },
    {
      "name": "OPENPAY_PRIVATE_KEY",
      "description": "Llave privada de Openpay",
      "required": false
    },
    {
      "name": "AWS_BUCKET_NAME",
      "description": "Nombre del bucket S3",
      "required": false,
      "default": "${INSTANCE_NAME}-files"
    }
  ],
  "services": [
    {
      "name": "app",
      "type": "application",
      "build": {
        "dockerfile": "Dockerfile.coolify"
      },
      "ports": ["3000"],
      "domains": ["${DOMAIN}"],
      "healthcheck": "/api/health",
      "environment": {
        "NODE_ENV": "production",
        "NEXTAUTH_URL": "https://${DOMAIN}",
        "DATABASE_URL": "postgresql://escalafin_${INSTANCE_NAME}:${POSTGRES_PASSWORD}@db:5432/${DATABASE_NAME}",
        "AWS_BUCKET_NAME": "${AWS_BUCKET_NAME}",
        "EVOLUTION_INSTANCE_NAME": "${INSTANCE_NAME}"
      }
    },
    {
      "name": "db",
      "type": "database",
      "image": "postgres:14-alpine",
      "environment": {
        "POSTGRES_USER": "escalafin_${INSTANCE_NAME}",
        "POSTGRES_PASSWORD": "${POSTGRES_PASSWORD}",
        "POSTGRES_DB": "${DATABASE_NAME}"
      },
      "volumes": ["postgres_data:/var/lib/postgresql/data"]
    },
    {
      "name": "redis",
      "type": "cache",
      "image": "redis:7-alpine",
      "command": "redis-server --requirepass ${REDIS_PASSWORD}",
      "volumes": ["redis_data:/data"]
    }
  ]
}
